{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nvar WEATHER_API_KEY = 'd8775601a4486e566e69e908c87962db';\nvar WEATHER_API_URL = 'https://api.openweathermap.org/data/2.5/weather';\nvar DEFAULT_LAT = 13.0827;\nvar DEFAULT_LON = 80.2707;\nvar DustDetectionService = function () {\n  function DustDetectionService() {\n    _classCallCheck(this, DustDetectionService);\n    this.weatherCache = null;\n    this.lastWeatherUpdate = null;\n    this.CACHE_DURATION = 10 * 60 * 1000;\n    this.TEMP_POWER_TABLE = {\n      24.09: {\n        min: 3,\n        max: 5\n      }\n    };\n    this.STC_TEMPERATURE = 25;\n    this.TEMPERATURE_COEFFICIENT = -0.45;\n    this.DUST_THRESHOLD_PERCENT = 15;\n    this.LIGHT_DUST_THRESHOLD = 10;\n  }\n  return _createClass(DustDetectionService, [{\n    key: \"fetchWeatherData\",\n    value: function () {\n      var _fetchWeatherData = _asyncToGenerator(function* () {\n        var lat = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_LAT;\n        var lon = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : DEFAULT_LON;\n        try {\n          if (this.weatherCache && this.lastWeatherUpdate) {\n            var timeSinceUpdate = Date.now() - this.lastWeatherUpdate;\n            if (timeSinceUpdate < this.CACHE_DURATION) {\n              console.log('üì¶ Using cached weather data');\n              return this.weatherCache;\n            }\n          }\n          var url = `${WEATHER_API_URL}?lat=${lat}&lon=${lon}&appid=${WEATHER_API_KEY}&units=metric`;\n          console.log('üå§Ô∏è Fetching weather data...');\n          console.log(`üìç Location: Lat ${lat}, Lon ${lon}`);\n          var response = yield fetch(url);\n          if (!response.ok) {\n            throw new Error(`Weather API error: ${response.status}`);\n          }\n          var data = yield response.json();\n          this.weatherCache = {\n            temperature: data.main.temp,\n            humidity: data.main.humidity,\n            clouds: data.clouds.all,\n            weather: data.weather[0].main,\n            description: data.weather[0].description,\n            location: data.name,\n            latitude: lat,\n            longitude: lon,\n            timestamp: new Date().toISOString()\n          };\n          this.lastWeatherUpdate = Date.now();\n          console.log('‚úÖ Weather data fetched:', this.weatherCache);\n          console.log(`üå°Ô∏è Temperature: ${this.weatherCache.temperature}¬∞C`);\n          console.log(`üìç Location: ${this.weatherCache.location}`);\n          return this.weatherCache;\n        } catch (error) {\n          console.error('‚ùå Error fetching weather data:', error);\n          return null;\n        }\n      });\n      function fetchWeatherData() {\n        return _fetchWeatherData.apply(this, arguments);\n      }\n      return fetchWeatherData;\n    }()\n  }, {\n    key: \"calculateExpectedPower\",\n    value: function calculateExpectedPower(ratedPower, currentTemperature) {\n      var tempKey = Object.keys(this.TEMP_POWER_TABLE).find(function (temp) {\n        return Math.abs(parseFloat(temp) - currentTemperature) < 0.5;\n      });\n      if (tempKey) {\n        var _this$TEMP_POWER_TABL = this.TEMP_POWER_TABLE[tempKey],\n          min = _this$TEMP_POWER_TABL.min,\n          max = _this$TEMP_POWER_TABL.max;\n        var _expectedPower = (min + max) / 2;\n        console.log(`   üìã Using reference table for ${tempKey}¬∞C: ${min}-${max}W (avg: ${_expectedPower}W)`);\n        return _expectedPower;\n      }\n      var tempDifference = currentTemperature - this.STC_TEMPERATURE;\n      var powerLossFactor = 1 + this.TEMPERATURE_COEFFICIENT / 100 * tempDifference;\n      var expectedPower = ratedPower * powerLossFactor;\n      return Math.max(0, expectedPower);\n    }\n  }, {\n    key: \"analyzeDustPresence\",\n    value: function analyzeDustPresence(actualPower, expectedPower, ratedPower) {\n      var currentTemp = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n      if (actualPower <= 0 || expectedPower <= 0) {\n        return {\n          hasDust: false,\n          dustLevel: 'unknown',\n          efficiency: 0,\n          powerLoss: 0,\n          recommendation: 'Panel not generating power'\n        };\n      }\n      var hasDust = false;\n      var dustLevel = 'clean';\n      var recommendation = 'Panel is operating normally';\n      var efficiency = actualPower / expectedPower * 100;\n      var powerLossPercent = (expectedPower - actualPower) / expectedPower * 100;\n      if (currentTemp !== null) {\n        var tempKey = Object.keys(this.TEMP_POWER_TABLE).find(function (temp) {\n          return Math.abs(parseFloat(temp) - currentTemp) < 0.5;\n        });\n        if (tempKey) {\n          var _this$TEMP_POWER_TABL2 = this.TEMP_POWER_TABLE[tempKey],\n            min = _this$TEMP_POWER_TABL2.min,\n            max = _this$TEMP_POWER_TABL2.max;\n          if (actualPower >= min && actualPower <= max) {\n            hasDust = false;\n            dustLevel = 'clean';\n            efficiency = 100;\n            powerLossPercent = 0;\n            recommendation = `‚úÖ Panel is clean. Power ${actualPower.toFixed(2)}W is within expected range ${min}-${max}W at ${currentTemp}¬∞C`;\n            console.log(`   ‚úÖ Power within acceptable range: ${min}W ‚â§ ${actualPower.toFixed(2)}W ‚â§ ${max}W`);\n          } else if (actualPower < min) {\n            var powerDeficit = (min - actualPower) / min * 100;\n            hasDust = true;\n            if (powerDeficit >= 15) {\n              dustLevel = 'heavy';\n              recommendation = `‚ö†Ô∏è Heavy dust detected! Power ${actualPower.toFixed(2)}W is below expected minimum ${min}W at ${currentTemp}¬∞C`;\n            } else {\n              dustLevel = 'light';\n              recommendation = `‚ö†Ô∏è Light dust detected. Power ${actualPower.toFixed(2)}W is slightly below expected minimum ${min}W at ${currentTemp}¬∞C`;\n            }\n            efficiency = actualPower / min * 100;\n            powerLossPercent = powerDeficit;\n            console.log(`   ‚ö†Ô∏è Power below minimum: ${actualPower.toFixed(2)}W < ${min}W (${powerDeficit.toFixed(2)}% deficit)`);\n          } else {\n            efficiency = actualPower / max * 100;\n            powerLossPercent = 0;\n            recommendation = `‚úÖ Panel performing above expected! Power ${actualPower.toFixed(2)}W exceeds maximum ${max}W`;\n            console.log(`   üåü Power above maximum: ${actualPower.toFixed(2)}W > ${max}W`);\n          }\n          return {\n            hasDust: hasDust,\n            dustLevel: dustLevel,\n            efficiency: efficiency.toFixed(2),\n            powerLoss: powerLossPercent.toFixed(2),\n            actualPower: actualPower.toFixed(2),\n            expectedPower: `${min}-${max}`,\n            recommendation: recommendation\n          };\n        }\n      }\n      if (powerLossPercent >= this.DUST_THRESHOLD_PERCENT) {\n        hasDust = true;\n        dustLevel = 'heavy';\n        recommendation = '‚ö†Ô∏è Heavy dust detected! Clean panel immediately to restore efficiency';\n      } else if (powerLossPercent >= this.LIGHT_DUST_THRESHOLD) {\n        hasDust = true;\n        dustLevel = 'light';\n        recommendation = '‚ö†Ô∏è Light dust accumulation detected. Consider cleaning soon';\n      }\n      return {\n        hasDust: hasDust,\n        dustLevel: dustLevel,\n        efficiency: efficiency.toFixed(2),\n        powerLoss: powerLossPercent.toFixed(2),\n        actualPower: actualPower.toFixed(2),\n        expectedPower: expectedPower.toFixed(2),\n        recommendation: recommendation\n      };\n    }\n  }, {\n    key: \"checkPanelDust\",\n    value: function () {\n      var _checkPanelDust = _asyncToGenerator(function* (panelId, actualVoltage, actualCurrent, actualPower, ratedPower) {\n        try {\n          console.log(`\\nüîç Checking dust on Solar Panel ${panelId}...`);\n          var weather = yield this.fetchWeatherData();\n          if (!weather) {\n            return {\n              success: false,\n              message: 'Could not fetch weather data'\n            };\n          }\n          var currentTemp = weather.temperature;\n          var expectedPower = this.calculateExpectedPower(ratedPower, currentTemp);\n          console.log(`\\nüìä Panel ${panelId} Analysis:`);\n          console.log(`   üå°Ô∏è Temperature: ${currentTemp}¬∞C`);\n          console.log(`   üìç Location: ${weather.location || 'Unknown'}`);\n          console.log(`   ‚ö° Expected Power: ${typeof expectedPower === 'number' ? expectedPower.toFixed(2) + 'W' : expectedPower}`);\n          console.log(`   ‚ö° Actual Power: ${actualPower}W`);\n          var dustAnalysis = this.analyzeDustPresence(actualPower, expectedPower, ratedPower, currentTemp);\n          return {\n            success: true,\n            panelId: panelId,\n            weather: {\n              temperature: currentTemp,\n              humidity: weather.humidity,\n              clouds: weather.clouds,\n              description: weather.description\n            },\n            dustAnalysis: dustAnalysis,\n            timestamp: new Date().toISOString()\n          };\n        } catch (error) {\n          console.error(`‚ùå Error checking dust on panel ${panelId}:`, error);\n          return {\n            success: false,\n            message: error.message\n          };\n        }\n      });\n      function checkPanelDust(_x, _x2, _x3, _x4, _x5) {\n        return _checkPanelDust.apply(this, arguments);\n      }\n      return checkPanelDust;\n    }()\n  }, {\n    key: \"checkAllPanels\",\n    value: function () {\n      var _checkAllPanels = _asyncToGenerator(function* (panelsData) {\n        var results = [];\n        for (var panel of panelsData) {\n          if (panel.voltage === '-' || panel.current === '-' || panel.power === '-') {\n            continue;\n          }\n          var voltage = parseFloat(panel.voltage);\n          var current = parseFloat(panel.current);\n          var power = parseFloat(panel.power);\n          var ratedPower = panel.ratedPower || 1000;\n          var result = yield this.checkPanelDust(panel.id, voltage, current, power, ratedPower);\n          results.push(result);\n        }\n        return results;\n      });\n      function checkAllPanels(_x6) {\n        return _checkAllPanels.apply(this, arguments);\n      }\n      return checkAllPanels;\n    }()\n  }, {\n    key: \"getDustSummary\",\n    value: function getDustSummary(dustResults) {\n      var totalPanels = dustResults.length;\n      var dustyPanels = dustResults.filter(function (r) {\n        return r.success && r.dustAnalysis.hasDust;\n      }).length;\n      var heavyDustPanels = dustResults.filter(function (r) {\n        return r.success && r.dustAnalysis.dustLevel === 'heavy';\n      }).length;\n      return {\n        totalPanels: totalPanels,\n        cleanPanels: totalPanels - dustyPanels,\n        dustyPanels: dustyPanels,\n        heavyDustPanels: heavyDustPanels,\n        needsCleaning: dustyPanels > 0\n      };\n    }\n  }]);\n}();\nexport default new DustDetectionService();","map":{"version":3,"names":["WEATHER_API_KEY","WEATHER_API_URL","DEFAULT_LAT","DEFAULT_LON","DustDetectionService","_classCallCheck","weatherCache","lastWeatherUpdate","CACHE_DURATION","TEMP_POWER_TABLE","min","max","STC_TEMPERATURE","TEMPERATURE_COEFFICIENT","DUST_THRESHOLD_PERCENT","LIGHT_DUST_THRESHOLD","_createClass","key","value","_fetchWeatherData","_asyncToGenerator","lat","arguments","length","undefined","lon","timeSinceUpdate","Date","now","console","log","url","response","fetch","ok","Error","status","data","json","temperature","main","temp","humidity","clouds","all","weather","description","location","name","latitude","longitude","timestamp","toISOString","error","fetchWeatherData","apply","calculateExpectedPower","ratedPower","currentTemperature","tempKey","Object","keys","find","Math","abs","parseFloat","_this$TEMP_POWER_TABL","expectedPower","tempDifference","powerLossFactor","analyzeDustPresence","actualPower","currentTemp","hasDust","dustLevel","efficiency","powerLoss","recommendation","powerLossPercent","_this$TEMP_POWER_TABL2","toFixed","powerDeficit","_checkPanelDust","panelId","actualVoltage","actualCurrent","success","message","dustAnalysis","checkPanelDust","_x","_x2","_x3","_x4","_x5","_checkAllPanels","panelsData","results","panel","voltage","current","power","result","id","push","checkAllPanels","_x6","getDustSummary","dustResults","totalPanels","dustyPanels","filter","r","heavyDustPanels","cleanPanels","needsCleaning"],"sources":["E:/Projects/MicroGrid App/ai-chat updated 4/Microgrid-app/src/services/DustDetectionService.js"],"sourcesContent":["// Dust Detection Service - Detects dust accumulation on solar panels\r\n// Uses weather API to get temperature and compares expected vs actual power output\r\n\r\nconst WEATHER_API_KEY = 'd8775601a4486e566e69e908c87962db';\r\nconst WEATHER_API_URL = 'https://api.openweathermap.org/data/2.5/weather';\r\n\r\n// Default location (can be configured)\r\nconst DEFAULT_LAT = 13.0827; // Chennai, India\r\nconst DEFAULT_LON = 80.2707;\r\n\r\nclass DustDetectionService {\r\n  constructor() {\r\n    this.weatherCache = null;\r\n    this.lastWeatherUpdate = null;\r\n    this.CACHE_DURATION = 10 * 60 * 1000; // 10 minutes\r\n    \r\n    // Temperature-to-Power reference table (based on real-world data)\r\n    this.TEMP_POWER_TABLE = {\r\n      24.09: { min: 3, max: 5 }, // At 24.09¬∞C, expected power is 3-5W\r\n    };\r\n    \r\n    // Standard Test Conditions (STC) reference values\r\n    this.STC_TEMPERATURE = 25; // 25¬∞C standard temperature\r\n    this.TEMPERATURE_COEFFICIENT = -0.45; // -0.45% per ¬∞C (typical for silicon panels)\r\n    \r\n    // Dust detection thresholds\r\n    this.DUST_THRESHOLD_PERCENT = 15; // 15% or more reduction indicates dust\r\n    this.LIGHT_DUST_THRESHOLD = 10; // 10-15% reduction\r\n  }\r\n\r\n  // Fetch current weather data\r\n  async fetchWeatherData(lat = DEFAULT_LAT, lon = DEFAULT_LON) {\r\n    try {\r\n      // Return cached data if still valid\r\n      if (this.weatherCache && this.lastWeatherUpdate) {\r\n        const timeSinceUpdate = Date.now() - this.lastWeatherUpdate;\r\n        if (timeSinceUpdate < this.CACHE_DURATION) {\r\n          console.log('üì¶ Using cached weather data');\r\n          return this.weatherCache;\r\n        }\r\n      }\r\n\r\n      const url = `${WEATHER_API_URL}?lat=${lat}&lon=${lon}&appid=${WEATHER_API_KEY}&units=metric`;\r\n      console.log('üå§Ô∏è Fetching weather data...');\r\n      console.log(`üìç Location: Lat ${lat}, Lon ${lon}`);\r\n      \r\n      const response = await fetch(url);\r\n      if (!response.ok) {\r\n        throw new Error(`Weather API error: ${response.status}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      \r\n      this.weatherCache = {\r\n        temperature: data.main.temp,\r\n        humidity: data.main.humidity,\r\n        clouds: data.clouds.all, // Cloud coverage percentage\r\n        weather: data.weather[0].main,\r\n        description: data.weather[0].description,\r\n        location: data.name,\r\n        latitude: lat,\r\n        longitude: lon,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n      \r\n      this.lastWeatherUpdate = Date.now();\r\n      \r\n      console.log('‚úÖ Weather data fetched:', this.weatherCache);\r\n      console.log(`üå°Ô∏è Temperature: ${this.weatherCache.temperature}¬∞C`);\r\n      console.log(`üìç Location: ${this.weatherCache.location}`);\r\n      return this.weatherCache;\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå Error fetching weather data:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Calculate expected power output based on temperature\r\n  // Uses lookup table for specific temperatures, otherwise uses formula\r\n  calculateExpectedPower(ratedPower, currentTemperature) {\r\n    // Check if we have a specific temperature reference\r\n    const tempKey = Object.keys(this.TEMP_POWER_TABLE).find(temp => \r\n      Math.abs(parseFloat(temp) - currentTemperature) < 0.5 // Within 0.5¬∞C tolerance\r\n    );\r\n\r\n    if (tempKey) {\r\n      // Use the reference table (return average of min and max)\r\n      const { min, max } = this.TEMP_POWER_TABLE[tempKey];\r\n      const expectedPower = (min + max) / 2;\r\n      console.log(`   üìã Using reference table for ${tempKey}¬∞C: ${min}-${max}W (avg: ${expectedPower}W)`);\r\n      return expectedPower;\r\n    }\r\n\r\n    // Otherwise use formula: P_expected = P_rated * (1 + coefficient * (T_actual - T_stc))\r\n    const tempDifference = currentTemperature - this.STC_TEMPERATURE;\r\n    const powerLossFactor = 1 + (this.TEMPERATURE_COEFFICIENT / 100) * tempDifference;\r\n    const expectedPower = ratedPower * powerLossFactor;\r\n    \r\n    return Math.max(0, expectedPower); // Power cannot be negative\r\n  }\r\n\r\n  // Analyze if dust is present on the panel\r\n  analyzeDustPresence(actualPower, expectedPower, ratedPower, currentTemp = null) {\r\n    if (actualPower <= 0 || expectedPower <= 0) {\r\n      return {\r\n        hasDust: false,\r\n        dustLevel: 'unknown',\r\n        efficiency: 0,\r\n        powerLoss: 0,\r\n        recommendation: 'Panel not generating power'\r\n      };\r\n    }\r\n\r\n    let hasDust = false;\r\n    let dustLevel = 'clean';\r\n    let recommendation = 'Panel is operating normally';\r\n    let efficiency = (actualPower / expectedPower) * 100;\r\n    let powerLossPercent = ((expectedPower - actualPower) / expectedPower) * 100;\r\n\r\n    // Check if we're using a reference temperature with min-max range\r\n    if (currentTemp !== null) {\r\n      const tempKey = Object.keys(this.TEMP_POWER_TABLE).find(temp => \r\n        Math.abs(parseFloat(temp) - currentTemp) < 0.5\r\n      );\r\n\r\n      if (tempKey) {\r\n        const { min, max } = this.TEMP_POWER_TABLE[tempKey];\r\n        \r\n        // If actual power is within the acceptable range, panel is clean\r\n        if (actualPower >= min && actualPower <= max) {\r\n          hasDust = false;\r\n          dustLevel = 'clean';\r\n          efficiency = 100; // Within acceptable range\r\n          powerLossPercent = 0;\r\n          recommendation = `‚úÖ Panel is clean. Power ${actualPower.toFixed(2)}W is within expected range ${min}-${max}W at ${currentTemp}¬∞C`;\r\n          console.log(`   ‚úÖ Power within acceptable range: ${min}W ‚â§ ${actualPower.toFixed(2)}W ‚â§ ${max}W`);\r\n        } else if (actualPower < min) {\r\n          // Below minimum acceptable power - dust detected\r\n          const powerDeficit = ((min - actualPower) / min) * 100;\r\n          hasDust = true;\r\n          \r\n          if (powerDeficit >= 15) {\r\n            dustLevel = 'heavy';\r\n            recommendation = `‚ö†Ô∏è Heavy dust detected! Power ${actualPower.toFixed(2)}W is below expected minimum ${min}W at ${currentTemp}¬∞C`;\r\n          } else {\r\n            dustLevel = 'light';\r\n            recommendation = `‚ö†Ô∏è Light dust detected. Power ${actualPower.toFixed(2)}W is slightly below expected minimum ${min}W at ${currentTemp}¬∞C`;\r\n          }\r\n          \r\n          efficiency = (actualPower / min) * 100;\r\n          powerLossPercent = powerDeficit;\r\n          console.log(`   ‚ö†Ô∏è Power below minimum: ${actualPower.toFixed(2)}W < ${min}W (${powerDeficit.toFixed(2)}% deficit)`);\r\n        } else {\r\n          // Above maximum (unusual but possible on very clear days)\r\n          efficiency = (actualPower / max) * 100;\r\n          powerLossPercent = 0;\r\n          recommendation = `‚úÖ Panel performing above expected! Power ${actualPower.toFixed(2)}W exceeds maximum ${max}W`;\r\n          console.log(`   üåü Power above maximum: ${actualPower.toFixed(2)}W > ${max}W`);\r\n        }\r\n\r\n        return {\r\n          hasDust,\r\n          dustLevel,\r\n          efficiency: efficiency.toFixed(2),\r\n          powerLoss: powerLossPercent.toFixed(2),\r\n          actualPower: actualPower.toFixed(2),\r\n          expectedPower: `${min}-${max}`,\r\n          recommendation\r\n        };\r\n      }\r\n    }\r\n\r\n    // Standard analysis using single expected power value\r\n    if (powerLossPercent >= this.DUST_THRESHOLD_PERCENT) {\r\n      hasDust = true;\r\n      dustLevel = 'heavy';\r\n      recommendation = '‚ö†Ô∏è Heavy dust detected! Clean panel immediately to restore efficiency';\r\n    } else if (powerLossPercent >= this.LIGHT_DUST_THRESHOLD) {\r\n      hasDust = true;\r\n      dustLevel = 'light';\r\n      recommendation = '‚ö†Ô∏è Light dust accumulation detected. Consider cleaning soon';\r\n    }\r\n\r\n    return {\r\n      hasDust,\r\n      dustLevel,\r\n      efficiency: efficiency.toFixed(2),\r\n      powerLoss: powerLossPercent.toFixed(2),\r\n      actualPower: actualPower.toFixed(2),\r\n      expectedPower: expectedPower.toFixed(2),\r\n      recommendation\r\n    };\r\n  }\r\n\r\n  // Main function to check dust on solar panel\r\n  async checkPanelDust(panelId, actualVoltage, actualCurrent, actualPower, ratedPower) {\r\n    try {\r\n      console.log(`\\nüîç Checking dust on Solar Panel ${panelId}...`);\r\n      \r\n      // Fetch current weather\r\n      const weather = await this.fetchWeatherData();\r\n      \r\n      if (!weather) {\r\n        return {\r\n          success: false,\r\n          message: 'Could not fetch weather data'\r\n        };\r\n      }\r\n\r\n      const currentTemp = weather.temperature;\r\n      \r\n      // Calculate expected power based on temperature\r\n      const expectedPower = this.calculateExpectedPower(ratedPower, currentTemp);\r\n      \r\n      console.log(`\\nüìä Panel ${panelId} Analysis:`);\r\n      console.log(`   üå°Ô∏è Temperature: ${currentTemp}¬∞C`);\r\n      console.log(`   üìç Location: ${weather.location || 'Unknown'}`);\r\n      console.log(`   ‚ö° Expected Power: ${typeof expectedPower === 'number' ? expectedPower.toFixed(2) + 'W' : expectedPower}`);\r\n      console.log(`   ‚ö° Actual Power: ${actualPower}W`);\r\n      \r\n      // Analyze dust presence (pass current temperature for range checking)\r\n      const dustAnalysis = this.analyzeDustPresence(actualPower, expectedPower, ratedPower, currentTemp);\r\n      \r\n      return {\r\n        success: true,\r\n        panelId,\r\n        weather: {\r\n          temperature: currentTemp,\r\n          humidity: weather.humidity,\r\n          clouds: weather.clouds,\r\n          description: weather.description\r\n        },\r\n        dustAnalysis,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n      \r\n    } catch (error) {\r\n      console.error(`‚ùå Error checking dust on panel ${panelId}:`, error);\r\n      return {\r\n        success: false,\r\n        message: error.message\r\n      };\r\n    }\r\n  }\r\n\r\n  // Check dust for multiple panels\r\n  async checkAllPanels(panelsData) {\r\n    const results = [];\r\n    \r\n    for (const panel of panelsData) {\r\n      if (panel.voltage === '-' || panel.current === '-' || panel.power === '-') {\r\n        continue; // Skip panels without data\r\n      }\r\n\r\n      const voltage = parseFloat(panel.voltage);\r\n      const current = parseFloat(panel.current);\r\n      const power = parseFloat(panel.power);\r\n      const ratedPower = panel.ratedPower || 1000; // Default 1000W if not specified\r\n\r\n      const result = await this.checkPanelDust(\r\n        panel.id,\r\n        voltage,\r\n        current,\r\n        power,\r\n        ratedPower\r\n      );\r\n\r\n      results.push(result);\r\n    }\r\n\r\n    return results;\r\n  }\r\n\r\n  // Get summary of all panels dust status\r\n  getDustSummary(dustResults) {\r\n    const totalPanels = dustResults.length;\r\n    const dustyPanels = dustResults.filter(r => r.success && r.dustAnalysis.hasDust).length;\r\n    const heavyDustPanels = dustResults.filter(\r\n      r => r.success && r.dustAnalysis.dustLevel === 'heavy'\r\n    ).length;\r\n\r\n    return {\r\n      totalPanels,\r\n      cleanPanels: totalPanels - dustyPanels,\r\n      dustyPanels,\r\n      heavyDustPanels,\r\n      needsCleaning: dustyPanels > 0\r\n    };\r\n  }\r\n}\r\n\r\nexport default new DustDetectionService();\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}