{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nvar WebSocketService = function () {\n  function WebSocketService() {\n    _classCallCheck(this, WebSocketService);\n    this.ws = null;\n    this.isConnected = false;\n    this.messageListeners = [];\n    this.reconnectAttempts = 0;\n    this.maxReconnectAttempts = 5;\n    this.reconnectInterval = 3000;\n    this.PRIMARY_WS_URL = 'ws://100.125.43.74:8080';\n    this.FALLBACK_WS_URL = 'ws://192.168.43.205:8080';\n    this.currentUrl = this.PRIMARY_WS_URL;\n  }\n  return _createClass(WebSocketService, [{\n    key: \"connect\",\n    value: function connect(url) {\n      var _this = this;\n      var wsUrl = url || this.currentUrl;\n      try {\n        console.log(`Attempting WebSocket connection to ${wsUrl}`);\n        this.ws = new WebSocket(wsUrl);\n        this.ws.onopen = function () {\n          console.log(`WebSocket connected to ${wsUrl}`);\n          _this.isConnected = true;\n          _this.reconnectAttempts = 0;\n          _this.currentUrl = wsUrl;\n          _this.notifyConnectionStatus('Connected');\n        };\n        this.ws.onmessage = function (event) {\n          try {\n            var message = JSON.parse(event.data);\n            console.log('Received WebSocket message:', message);\n            _this.messageListeners.forEach(function (callback) {\n              callback(message);\n            });\n          } catch (error) {\n            console.error('Error parsing WebSocket message:', error);\n          }\n        };\n        this.ws.onclose = function () {\n          console.log('WebSocket connection closed');\n          _this.isConnected = false;\n          _this.notifyConnectionStatus('Disconnected');\n          _this.attemptReconnect();\n        };\n        this.ws.onerror = function (error) {\n          console.error(`WebSocket error on ${wsUrl}:`, error);\n          _this.isConnected = false;\n          if (wsUrl === _this.PRIMARY_WS_URL && !url) {\n            console.log('Primary WebSocket failed, trying fallback...');\n            _this.currentUrl = _this.FALLBACK_WS_URL;\n            setTimeout(function () {\n              return _this.connect();\n            }, 1000);\n          } else {\n            _this.notifyConnectionStatus('Error');\n          }\n        };\n      } catch (error) {\n        console.error('Failed to create WebSocket connection:', error);\n        this.notifyConnectionStatus('Failed to Connect');\n      }\n    }\n  }, {\n    key: \"attemptReconnect\",\n    value: function attemptReconnect() {\n      var _this2 = this;\n      if (this.reconnectAttempts < this.maxReconnectAttempts) {\n        this.reconnectAttempts++;\n        console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`);\n        this.notifyConnectionStatus('Reconnecting...');\n        setTimeout(function () {\n          _this2.connect();\n        }, this.reconnectInterval);\n      } else {\n        console.log('Max reconnection attempts reached');\n        this.notifyConnectionStatus('Connection Failed');\n      }\n    }\n  }, {\n    key: \"addMessageListener\",\n    value: function addMessageListener(callback) {\n      this.messageListeners.push(callback);\n    }\n  }, {\n    key: \"removeMessageListener\",\n    value: function removeMessageListener(callback) {\n      var index = this.messageListeners.indexOf(callback);\n      if (index > -1) {\n        this.messageListeners.splice(index, 1);\n      }\n    }\n  }, {\n    key: \"notifyConnectionStatus\",\n    value: function notifyConnectionStatus(status) {\n      this.connectionStatusListeners = this.connectionStatusListeners || [];\n      this.connectionStatusListeners.forEach(function (callback) {\n        return callback(status);\n      });\n    }\n  }, {\n    key: \"addConnectionStatusListener\",\n    value: function addConnectionStatusListener(callback) {\n      this.connectionStatusListeners = this.connectionStatusListeners || [];\n      this.connectionStatusListeners.push(callback);\n    }\n  }, {\n    key: \"removeConnectionStatusListener\",\n    value: function removeConnectionStatusListener(callback) {\n      if (this.connectionStatusListeners) {\n        var index = this.connectionStatusListeners.indexOf(callback);\n        if (index > -1) {\n          this.connectionStatusListeners.splice(index, 1);\n        }\n      }\n    }\n  }, {\n    key: \"disconnect\",\n    value: function disconnect() {\n      if (this.ws) {\n        this.ws.close();\n        this.ws = null;\n        this.isConnected = false;\n        this.messageListeners = [];\n        this.connectionStatusListeners = [];\n      }\n    }\n  }, {\n    key: \"send\",\n    value: function send(data) {\n      if (this.ws && this.isConnected) {\n        this.ws.send(JSON.stringify(data));\n      } else {\n        console.warn('WebSocket not connected');\n      }\n    }\n  }]);\n}();\nexport default new WebSocketService();","map":{"version":3,"names":["WebSocketService","_classCallCheck","ws","isConnected","messageListeners","reconnectAttempts","maxReconnectAttempts","reconnectInterval","PRIMARY_WS_URL","FALLBACK_WS_URL","currentUrl","_createClass","key","value","connect","url","_this","wsUrl","console","log","WebSocket","onopen","notifyConnectionStatus","onmessage","event","message","JSON","parse","data","forEach","callback","error","onclose","attemptReconnect","onerror","setTimeout","_this2","addMessageListener","push","removeMessageListener","index","indexOf","splice","status","connectionStatusListeners","addConnectionStatusListener","removeConnectionStatusListener","disconnect","close","send","stringify","warn"],"sources":["E:/Projects/MicroGrid App/ai-chat updated 4/Microgrid-app/src/services/WebSocketService.js"],"sourcesContent":["class WebSocketService {\r\n  constructor() {\r\n    this.ws = null;\r\n    this.isConnected = false;\r\n    this.messageListeners = [];\r\n    this.reconnectAttempts = 0;\r\n    this.maxReconnectAttempts = 5;\r\n    this.reconnectInterval = 3000; // 3 seconds\r\n    // WebSocket bridge runs on this PC (100.125.43.74), not on database server\r\n    this.PRIMARY_WS_URL = 'ws://100.125.43.74:8080';  // This PC Tailscale IP\r\n    this.FALLBACK_WS_URL = 'ws://192.168.43.205:8080'; // Local Wi-Fi fallback\r\n    this.currentUrl = this.PRIMARY_WS_URL;\r\n  }\r\n\r\n  connect(url) {\r\n    // Use provided URL or try current URL (primary or fallback)\r\n    const wsUrl = url || this.currentUrl;\r\n    \r\n    try {\r\n      console.log(`Attempting WebSocket connection to ${wsUrl}`);\r\n      this.ws = new WebSocket(wsUrl);\r\n\r\n      this.ws.onopen = () => {\r\n        console.log(`WebSocket connected to ${wsUrl}`);\r\n        this.isConnected = true;\r\n        this.reconnectAttempts = 0;\r\n        this.currentUrl = wsUrl; // Remember successful URL\r\n        this.notifyConnectionStatus('Connected');\r\n      };\r\n\r\n      this.ws.onmessage = (event) => {\r\n        try {\r\n          const message = JSON.parse(event.data);\r\n          console.log('Received WebSocket message:', message);\r\n          \r\n          // Notify all listeners\r\n          this.messageListeners.forEach(callback => {\r\n            callback(message);\r\n          });\r\n        } catch (error) {\r\n          console.error('Error parsing WebSocket message:', error);\r\n        }\r\n      };\r\n\r\n      this.ws.onclose = () => {\r\n        console.log('WebSocket connection closed');\r\n        this.isConnected = false;\r\n        this.notifyConnectionStatus('Disconnected');\r\n        this.attemptReconnect();\r\n      };\r\n\r\n      this.ws.onerror = (error) => {\r\n        console.error(`WebSocket error on ${wsUrl}:`, error);\r\n        this.isConnected = false;\r\n        \r\n        // Try fallback if primary failed and not manually provided URL\r\n        if (wsUrl === this.PRIMARY_WS_URL && !url) {\r\n          console.log('Primary WebSocket failed, trying fallback...');\r\n          this.currentUrl = this.FALLBACK_WS_URL;\r\n          setTimeout(() => this.connect(), 1000);\r\n        } else {\r\n          this.notifyConnectionStatus('Error');\r\n        }\r\n      };\r\n\r\n    } catch (error) {\r\n      console.error('Failed to create WebSocket connection:', error);\r\n      this.notifyConnectionStatus('Failed to Connect');\r\n    }\r\n  }\r\n\r\n  attemptReconnect() {\r\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\r\n      this.reconnectAttempts++;\r\n      console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`);\r\n      this.notifyConnectionStatus('Reconnecting...');\r\n      \r\n      setTimeout(() => {\r\n        this.connect();\r\n      }, this.reconnectInterval);\r\n    } else {\r\n      console.log('Max reconnection attempts reached');\r\n      this.notifyConnectionStatus('Connection Failed');\r\n    }\r\n  }\r\n\r\n  addMessageListener(callback) {\r\n    this.messageListeners.push(callback);\r\n  }\r\n\r\n  removeMessageListener(callback) {\r\n    const index = this.messageListeners.indexOf(callback);\r\n    if (index > -1) {\r\n      this.messageListeners.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  notifyConnectionStatus(status) {\r\n    // This will be used to notify components about connection status changes\r\n    this.connectionStatusListeners = this.connectionStatusListeners || [];\r\n    this.connectionStatusListeners.forEach(callback => callback(status));\r\n  }\r\n\r\n  addConnectionStatusListener(callback) {\r\n    this.connectionStatusListeners = this.connectionStatusListeners || [];\r\n    this.connectionStatusListeners.push(callback);\r\n  }\r\n\r\n  removeConnectionStatusListener(callback) {\r\n    if (this.connectionStatusListeners) {\r\n      const index = this.connectionStatusListeners.indexOf(callback);\r\n      if (index > -1) {\r\n        this.connectionStatusListeners.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  disconnect() {\r\n    if (this.ws) {\r\n      this.ws.close();\r\n      this.ws = null;\r\n      this.isConnected = false;\r\n      this.messageListeners = [];\r\n      this.connectionStatusListeners = [];\r\n    }\r\n  }\r\n\r\n  send(data) {\r\n    if (this.ws && this.isConnected) {\r\n      this.ws.send(JSON.stringify(data));\r\n    } else {\r\n      console.warn('WebSocket not connected');\r\n    }\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport default new WebSocketService();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}